services:
  voicevox:
    image: voicevox/voicevox_engine:cpu-ubuntu20.04-latest

  web:
    build:
      context: .
      target: development
    tty: true
    volumes:
      - type: bind
        source: Cargo.lock
        target: /usr/src/myapp/Cargo.lock
      - type: bind
        source: Cargo.toml
        target: /usr/src/myapp/Cargo.toml
      - type: bind
        source: seitai
        target: /usr/src/myapp/seitai
      - type: bind
        source: restarter
        target: /usr/src/myapp/restarter
    command: /bin/sh -c 'cargo run -p seitai'
    environment:
      - DISCORD_TOKEN
      - VOICEVOX_HOST=voicevox

  restarter:
    build:
      context: .
      target: development
    tty: true
    volumes:
      - type: bind
        source: Cargo.lock
        target: /usr/src/myapp/Cargo.lock
      - type: bind
        source: Cargo.toml
        target: /usr/src/myapp/Cargo.toml
      - type: bind
        source: seitai
        target: /usr/src/myapp/seitai
      - type: bind
        source: restarter
        target: /usr/src/myapp/restarter
    command: /bin/sh -c 'cargo run -p restarter'
    environment:
      - DISCORD_TOKEN
